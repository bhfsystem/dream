#!/usr/bin/env bash

function main {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"

  local nm_provider="$1"; shift
  local pth_box=

  case "$nm_provider" in
    virtualbox|aws)
      true ;;
    digitalocean|digital_ocean)
      nm_provider="digitalocean"
      ;;
    *)
      if [[ -f "$nm_provider" ]]; then
        pth_box="$nm_provider"
        nm_provider=
      else
        echo ERROR: "Invalid virtualization type: $nm_provider" 1>&2
        return 1
      fi
      ;;
  esac

  cd "$shome"
  vagrant box add --name ubuntu${1:+"-$1"} "${pth_box:-"$(set +f; ls -trd "$shome/box/$nm_provider"/*${1:+-$1*}.box | tail -1)"}"
}

source sub "$0" "$@"

